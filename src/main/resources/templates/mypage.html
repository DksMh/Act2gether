<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>여행 추천 플랫폼</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/mypage.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap"
      rel="stylesheet"
    />
    <script src="/js/mypage.js"></script>
    <!-- <script src="/js/interestonboarding.js"></script> -->
  </head>
  <body>
    <!-- Header -->
    <div th:replace="header :: header"></div>

    <main class="container">

    <span id="emailSpan" th:text="${email}" style="display:none">없음</span>
    <span id="usernameSpan" th:text="${username}" style="display:none">없음</span>
    <!-- 상단 프로필 -->
    <div class="profile">
      <div class="avatar"><img id="profileAvatar"
     th:src="@{'/profile/avatars/user/' + ${username}}"
     alt="프로필" /></div>
      <div class="user-meta">
        <h1><span id="nickname"></span>님</h1>
        <div class="sub">
        <span id="ageGroup"></span> | 
        <span id="gender"></span> | 
        <span id="location"></span> 거주
        </div>
      </div>
      <div style="margin-left:auto" class="row">
        <!-- <span class="chip">선호 투어 정보 수정</span> -->
        <button class="btn-sm" id="tour">선호 투어 정보 수정</button>
        <button class="btn-sm" id="settings">개인정보 설정</button>
      </div>
    </div>

    <!-- 선호하는 여행 -->
    <section>
        <h2 class="section-title">선호하는 여행</h2>

        <div style="margin:10px 0 6px; color:var(--muted); font-weight:600; font-size:13px">선호 지역</div>
        <div class="subtabs" id="prefRegions"></div>

        <div style="margin:10px 0 6px; color:var(--muted); font-weight:600; font-size:13px">선호 여행지</div>
        <div class="subtabs" id="prefPlaces"></div>

        <div style="margin:10px 0 6px; color:var(--muted); font-weight:600; font-size:13px">선호 시설</div>
        <div class="subtabs" id="prefFacilities"></div>

    </section>

    <!-- 현재 가입된 모임 -->
    <section>
      <div class="row" style="justify-content:space-between; align-items:baseline">
        <h2 class="section-title">현재 가입된 모임</h2>
        <div class="row" style="gap:8px">
          <span class="pill" data-filter="upcoming" role="button" tabindex="0" aria-pressed="true">여행 전 모임</span>
          <span class="pill" data-filter="done"      role="button" tabindex="0" aria-pressed="false">종료된 모임</span>
        </div>
      </div>

      <div class="grid-3" id="gathering"></div>
      <button id="seeAllBtn-m" class="see-all" style="display:none">전체 보기</button>
      <button id="seeShortBtn-m" class="see-short" style="display:none">축소</button>
    </section>

    <!-- 찜 목록 -->
    <section id="wishlist">
      <h2 class="section-title">찜목록</h2>
      <div class="grid-like" id="wishlistList"></div>
      <button id="seeAllBtn-w" class="see-all" style="display:none">전체 보기</button>
      <button id="seeShortBtn-w" class="see-short" style="display:none">축소</button>
    </section>

    <!-- 나의 리뷰 -->
    <section class="reviews">
        <h2 class="section-title">나의 리뷰</h2>
        <div id="reviewList"></div>
        <button id="seeAllBtn-r" class="see-all" style="display:none">전체 보기</button>
        <button id="seeShortBtn-r" class="see-short" style="display:none">축소</button>
    </section>

  </main>

  <!-- 모달 오버레이 -->
<div id="interestModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="interestModalTitle">
  <div class="modal__dialog" role="document">
    <button class="modal__close" aria-label="닫기" onclick="closeInterestModal()">×</button>

    <!-- 기존 섹션을 그대로 모달 안으로 이동/복붙 -->
    <div class="onboarding-container">
      <div id="interestSelection" class="interest-selection">
        <div class="page-header">
          <h1 class="page-title" id="interestModalTitle">관심사 설정</h1>
          <p class="page-subtitle">
            맞춤형 여행 추천을 위해 관심사를 선택해주세요.<br />
            <span class="highlight">여러 개</span>를 선택할 수 있습니다.
          </p>
        </div>

        <!-- Questions -->
        <div class="question-section">
          <h3 class="question-title">1. 어떤 지역을 선호하시나요?</h3>
          <p class="question-subtitle">복수 선택 가능</p>
          <div class="options-grid" id="regionOptions">
            <button class="option-button" data-value="서울">서울</button>
            <button class="option-button" data-value="부산">부산</button>
            <button class="option-button" data-value="대구">대구</button>
            <button class="option-button" data-value="인천">인천</button>
            <button class="option-button" data-value="광주">광주</button>
            <button class="option-button" data-value="대전">대전</button>
            <button class="option-button" data-value="울산">울산</button>
            <button class="option-button" data-value="세종">세종</button>
            <button class="option-button" data-value="경기">경기</button>
            <button class="option-button" data-value="강원">강원</button>
            <button class="option-button" data-value="충북">충북</button>
            <button class="option-button" data-value="충남">충남</button>
            <button class="option-button" data-value="전북">전북</button>
            <button class="option-button" data-value="전남">전남</button>
            <button class="option-button" data-value="경북">경북</button>
            <button class="option-button" data-value="경남">경남</button>
            <button class="option-button" data-value="제주">제주</button>
          </div>
        </div>

        <div class="question-section">
          <h3 class="question-title">2. 어떤 장소로 가고 싶으신가요?</h3>
          <p class="question-subtitle">복수 선택 가능</p>
          <div class="options-grid" id="placeOptions">
            <button class="option-button" data-value="해변">해변</button>
            <button class="option-button" data-value="산">산</button>
            <button class="option-button" data-value="도시관광">도시관광</button>
            <button class="option-button" data-value="시골">시골</button>
            <button class="option-button" data-value="호수">호수</button>
            <button class="option-button" data-value="온천지역">온천지역</button>
            <button class="option-button" data-value="섬지역">섬지역</button>
          </div>
        </div>

        <div class="question-section">
          <h3 class="question-title">3. 개인적으로 필요한 사항이 있으신가요?</h3>
          <p class="question-subtitle">복수 선택 가능</p>
          <div class="options-grid" id="needsOptions">
            <button class="option-button" data-value="접근성">접근성</button>
            <button class="option-button" data-value="휠체어">휠체어</button>
            <button class="option-button" data-value="유치원시설">유치원시설</button>
            <button class="option-button" data-value="병원">병원</button>
            <button class="option-button" data-value="약국">약국</button>
            <button class="option-button" data-value="응급실">응급실</button>
            <button class="option-button" data-value="없음">없음</button>
          </div>
        </div>

        <!-- Button Group -->
        <div class="button-group">
          <!-- <button class="btn btn-secondary" onclick="skipOnboarding()">나중에 설정</button> -->
          <button class="btn btn-primary" onclick="completeOnboarding()">완료</button>
        </div>

        <!-- 메시지 영역 -->
        <div class="message-area">
          <div id="interestErrorMessage" class="error-message" hidden>
            <p id="interestErrorText">관심사 저장에 실패했습니다. 다시 시도해주세요.</p>
            <button class="retry-button" onclick="retryInterestSubmission()">다시 시도</button>
          </div>

          <div id="successMessage" class="success-message" hidden>
            <p>관심사가 성공적으로 저장되었습니다!</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 닉네임/거주지역 변경 모달 -->
<div id="nickRegionModal" class="nr-modal" hidden>
  <div class="nr-backdrop"></div>

  <div class="nr-panel" role="dialog" aria-modal="true" aria-labelledby="nrTitle">
    <div class="nr-header">
      <h3 id="nrTitle">닉네임 / 거주지역 변경</h3>
      <button type="button" class="nr-close" aria-label="닫기">✕</button>
    </div>

    <div class="nr-body">
      <label class="nr-label" for="nrNickname" >닉네임</label>
      <input id="nrNickname" class="nr-input" type="text" maxlength="12" th:value="${username}" placeholder="닉네임을 입력하세요" />

      <label class="nr-label" for="nrRegion">거주지역</label>
      <select id="nrRegion" class="nr-input">
        <!-- <option value="">선택해주세요</option> -->
        <option>서울</option><option>경기</option><option>인천</option>
        <option>부산</option><option>대구</option><option>대전</option>
        <option>광주</option><option>울산</option><option>세종</option>
        <option>강원</option><option>충북</option><option>충남</option>
        <option>전북</option><option>전남</option>
        <option>경북</option><option>경남</option><option>제주</option>
      </select>
    </div>

    <div class="nr-footer">
      <button type="button" class="nr-btn nr-cancel">취소</button>
      <button type="button" class="nr-btn nr-save">완료</button>
    </div>
  </div>
</div>

<!-- 비밀번호 변경 모달 -->
<div id="pwModal" class="pw-modal" hidden>
  <div class="pw-backdrop"></div>

  <div class="pw-panel" role="dialog" aria-modal="true" aria-labelledby="pwTitle">
    <button type="button" class="pw-close" aria-label="닫기">✕</button>

    <h3 id="pwTitle" class="pw-title">비밀번호 변경</h3>

    <div class="pw-body">
      <label class="pw-label" for="pwCurrent">현재 비밀번호</label>
      <input id="pwCurrent" class="pw-input" type="password" autocomplete="current-password"
             placeholder="사용 중인 비밀번호를 입력해주세요" />

      <label class="pw-label" for="pwNew">새 비밀번호</label>
      <input id="pwNew" class="pw-input" type="password" autocomplete="new-password"
             placeholder="영문, 숫자, 특수문자 12자 이내 입력해주세요" />

      <label class="pw-label" for="pwNew2">새 비밀번호 확인</label>
      <input id="pwNew2" class="pw-input" type="password" autocomplete="new-password"
             placeholder="한 번 더 입력해주세요" />

      <button type="button" class="pw-submit">완료</button>
      <p class="pw-help">비밀번호를 바꾸면 새 비밀번호로 다시 접속해주세요.</p>
    </div>
  </div>
</div>

    <!-- Footer -->
     <div th:replace="footer :: footer"></div>
  </body>
</html>