<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>고객센터 - QNA</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/qna.css" />
    <!-- <link rel="stylesheet" href="/css/customerservice.css" /> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- JavaScript 파일들 - 의존성 순서 정리 -->
    <script src="/js/qna-api.js"></script>
    <script src="/js/qna-ui.js"></script>
    <script src="/js/qna-main.js"></script>
  </head>
  <body>
    <!-- Header -->
    <div th:replace="header :: header"></div>

    <section class="customerservice-section">
      <!-- 상단 타이틀 -->
      <div class="page-title">
        <h1>QnA</h1>
        <p>
          여기부터 서비스 이용 중 궁금한 사항을 자유롭게 질문하고 답변을
          확인해보세요.
        </p>
      </div>

      <!-- Q&A 이용안내 -->
      <div class="qna-guide">
        <h2>Q&A 게시판 이용안내</h2>
        <ul class="guide-list">
          <li>
            ※ 운영취지에 위반되는 게시물은 관리자에 의해 삭제될 수 있다는 점
            유의하여 주십시오.
          </li>
          <li>
            ※ 많은 분들이 문의하신 질문은 <b><a href="/faq">FAQ</a></b
            >에 등록하였으니 많은 이용 부탁드립니다.
          </li>
          <li>※ 개인정보가 포함된 문의는 <b>비공개</b>로 작성해주세요.</li>
          <li>※ 이미지는 최대 5개까지 첨부 가능합니다.</li>
        </ul>
      </div>

      <!-- 검색 및 필터 영역 -->
      <div class="qna-search-section">
        <div class="search-container">
          <!-- 검색바 -->
          <div class="search-bar">
            <div class="search-input-group">
              <input
                type="text"
                id="searchInput"
                placeholder="제목 또는 내용으로 검색하세요..."
                class="search-input"
              />
              <button id="searchBtn" class="btn btn-search">검색</button>
            </div>
          </div>

          <!-- 필터 옵션 -->
          <div class="filter-container">
            <div class="filter-group">
              <label class="filter-label">카테고리</label>
              <select id="categoryFilter" class="filter-select">
                <option value="">전체</option>
                <option value="일반문의">일반문의</option>
                <option value="신고">신고</option>
              </select>
            </div>

            <div class="filter-group">
              <label class="filter-label">답변상태</label>
              <select id="statusFilter" class="filter-select">
                <option value="">전체</option>
                <option value="답변 대기">답변대기</option>
                <option value="답변 완료">답변완료</option>
              </select>
            </div>

            <div class="filter-group">
              <label class="filter-toggle">
                <input type="checkbox" id="myPostsOnly" />
                <span class="toggle-slider"></span>
                내 글만 보기
              </label>
            </div>

            <button id="resetFilters" class="btn btn-outline btn-small">
              <i class="fas fa-refresh"></i>
              초기화
            </button>
          </div>
        </div>
      </div>

      <!-- QnA 게시판 목록 영역 -->
      <div id="qnaBoardView" class="qna-board">
        <!-- 게시글 목록 헤더 -->
        <div class="qna-board-header">
          <h3 class="board-title">문의 목록</h3>
          <div class="qna-board-actions">
            <div class="posts-count">
              총 <span id="totalCount">0</span>개의 문의
            </div>
            <button id="writeBtn" class="btn btn-primary" style="display: none">
              <i class="fas fa-pen"></i>
              문의 작성
            </button>
          </div>
        </div>

        <!-- 로딩 인디케이터 -->
        <div
          id="loadingIndicator"
          class="loading-indicator"
          style="display: none"
        >
          <i class="fas fa-spinner fa-spin"></i>
          <span>로딩 중...</span>
        </div>

        <!-- 게시글 목록 테이블 -->
        <div class="qna-table-container">
          <table id="qnaTable" class="qna-board-table">
            <thead>
              <tr>
                <th style="width: 60px">번호</th>
                <th style="width: 100px">카테고리</th>
                <th>제목</th>
                <th style="width: 100px">작성자</th>
                <th style="width: 100px">작성일</th>
                <th style="width: 80px">조회수</th>
                <th style="width: 100px">답변상태</th>
              </tr>
            </thead>
            <tbody id="postsList">
              <!-- 게시글 항목들이 동적으로 추가됩니다 -->
            </tbody>
          </table>
        </div>

        <!-- 페이지네이션 -->
        <div id="pagination" class="pagination">
          <!-- 페이지 버튼들이 동적으로 추가됩니다 -->
        </div>
      </div>

      <!-- 게시글 작성/수정 페이지 -->
      <div id="qnaWriteView" class="qna-write-page" style="display: none">
        <div class="page-header">
          <h2 id="writeTitle">문의 작성</h2>
          <div class="page-actions">
            <button id="cancelWriteBtn" class="btn btn-outline">
              <i class="fas fa-arrow-left"></i>
              목록으로
            </button>
          </div>
        </div>

        <form id="postForm" class="qna-write-form">
          <div class="form-group">
            <label for="postCategory" class="form-label">카테고리 *</label>
            <select id="postCategory" class="form-control" required>
              <option value="">카테고리 선택</option>
              <option value="일반문의">일반문의</option>
              <option value="신고">신고</option>
            </select>
          </div>

          <div class="form-group">
            <label for="postTitle" class="form-label">제목 *</label>
            <input
              type="text"
              id="postTitle"
              class="form-control"
              placeholder="제목을 입력해주세요"
              maxlength="255"
              required
            />
            <div class="char-counter"><span id="titleCounter">0</span>/255</div>
          </div>

          <div class="form-group">
            <label for="postContent" class="form-label">내용 *</label>
            <textarea
              id="postContent"
              class="form-control textarea"
              placeholder="문의 내용을 자세히 작성해주세요"
              rows="12"
              maxlength="5000"
              required
            ></textarea>
            <div class="char-counter">
              <span id="contentCounter">0</span>/5000
            </div>
          </div>

          <div class="form-group">
            <label for="postImage" class="form-label">이미지 첨부</label>
            <div class="file-upload-area" id="fileUploadArea">
              <input
                type="file"
                id="postImage"
                class="file-input"
                accept="image/jpeg,image/jpg,image/png,image/webp"
                multiple
                style="display: none"
              />
              <div class="file-upload-content">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>클릭하여 이미지를 선택하거나 드래그하여 업로드하세요</p>
                <p class="file-info">JPG, PNG, WebP 파일 (최대 3MB, 5개까지)</p>
              </div>
            </div>

            <!-- 다중 이미지 미리보기 컨테이너 -->
            <div
              id="imagePreviewContainer"
              class="image-preview-container"
              style="display: none"
            >
              <!-- 선택된 이미지들이 동적으로 추가됩니다 -->
            </div>

            <!-- 이미지 개수 및 안내 -->
            <div class="multi-image-info" id="imageInfo" style="display: none">
              <span class="current-image-count"
                >선택된 이미지: <span id="currentImageCount">0</span>개</span
              >
              <span class="image-limit-text">최대 5개</span>
            </div>
          </div>

          <div class="form-group">
            <label class="form-checkbox">
              <input type="checkbox" id="isLocked" checked />
              <span class="checkbox-mark"></span>
              비공개 설정 (본인만 볼 수 있음)
            </label>
            <p class="form-help">
              체크 해제 시 다른 사용자도 게시글을 볼 수 있습니다.
            </p>
          </div>

          <div class="form-actions">
            <button type="button" id="cancelBtn" class="btn btn-outline">
              취소
            </button>
            <button type="submit" id="submitBtn" class="btn btn-primary">
              <i class="fas fa-save"></i>
              <span id="submitText">작성하기</span>
            </button>
          </div>
        </form>
      </div>

      <!-- 게시글 상세 보기 페이지 -->
      <div id="qnaDetailView" class="qna-detail-page" style="display: none">
        <div class="detail-header-section">
          <div class="page-header">
            <div class="page-nav">
              <button id="backToListBtn" class="btn btn-outline">
                <i class="fas fa-arrow-left"></i>
                목록으로
              </button>
            </div>
            <div class="detail-actions">
              <button
                id="editPostBtn"
                class="btn btn-small btn-outline"
                style="display: none"
              >
                <i class="fas fa-edit"></i>
                수정
              </button>
              <button
                id="deletePostBtn"
                class="btn btn-small btn-danger"
                style="display: none"
              >
                <i class="fas fa-trash"></i>
                삭제
              </button>
            </div>
          </div>

          <div class="detail-meta-section">
            <div class="detail-badges">
              <span id="detailCategory" class="category-badge"></span>
              <span id="detailStatus" class="status-badge"></span>
            </div>
            <div class="detail-info">
              <span id="detailAuthor"></span>
              <span id="detailDate"></span>
              <span id="detailViews"></span>
            </div>
          </div>

          <h1 id="detailTitle" class="detail-title"></h1>
        </div>

        <div class="detail-content-section">
          <div class="detail-content">
            <div id="detailContentText" class="content-text"></div>
            <!-- 다중 이미지 갤러리 -->
            <div
              id="detailImageGallery"
              class="detail-image-gallery"
              style="display: none"
            >
              <!-- 이미지들이 동적으로 추가됩니다 -->
            </div>
          </div>

          <!-- 답변 섹션 -->
          <div class="replies-section">
            <h3 class="replies-title">
              <i class="fas fa-comments"></i>
              관리자 답변
            </h3>

            <!-- 관리자 답변 작성 폼 (관리자만) -->
            <div id="replyForm" class="reply-form" style="display: none">
              <div class="form-group">
                <label for="replyContent" class="form-label">답변 작성</label>
                <textarea
                  id="replyContent"
                  class="form-control textarea"
                  placeholder="답변을 작성해주세요..."
                  rows="6"
                  maxlength="2000"
                ></textarea>
                <div class="char-counter">
                  <span id="replyCounter">0</span>/2000
                </div>
              </div>
              <div class="reply-actions">
                <button id="submitReply" class="btn btn-primary">
                  <i class="fas fa-paper-plane"></i>
                  답변 작성
                </button>
              </div>
            </div>

            <!-- 답변 목록 -->
            <div id="repliesList" class="replies-list">
              <!-- 답변들이 동적으로 추가됩니다 -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 알림 토스트 -->
    <div id="toast" class="toast">
      <div class="toast-content">
        <i id="toastIcon" class="toast-icon"></i>
        <span id="toastMessage"></span>
      </div>
    </div>

    <!-- 확인 다이얼로그 -->
    <div id="confirmDialog" class="qna-modal">
      <div class="modal-content modal-small">
        <div class="modal-header">
          <h3 id="confirmTitle">확인</h3>
        </div>
        <div class="modal-body">
          <p id="confirmMessage"></p>
        </div>
        <div class="modal-footer">
          <button id="confirmCancel" class="btn btn-outline">취소</button>
          <button id="confirmOk" class="btn btn-danger">확인</button>
        </div>
      </div>
    </div>

    <!-- 이미지 상세보기 모달 -->
    <div id="imageModal" class="image-modal">
      <span class="image-modal-close">&times;</span>
      <img id="modalImage" src="" alt="이미지 상세보기" />
    </div>

    <!-- Footer -->
    <div th:replace="footer :: footer"></div>
  </body>
</html>
