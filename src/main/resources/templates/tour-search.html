<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>여기부터 - 투어 검색 v2.3 Enhanced</title>
    <!-- CSS 파일들 -->
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/tour-search.css" />
    <!-- 폰트 -->
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  </head>

  <body>
    <!-- Header -->
    <div th:replace="~{header :: header}"></div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-spinner">
      <div class="spinner"></div>
    </div>

    <!-- Main Container -->
    <div class="tour-search-container">
      <!-- Page Header -->
      <div class="page-header">
        <h1 class="page-title">
          🎯 어떤 여행을 떠나볼까요? 
          <span class="version-badge">v2.3 Enhanced</span>
        </h1>
        <p class="page-subtitle">
          🚀 <strong>선택 수 확대!</strong> 논리적 조합만 검색하여 더 정확한 결과!
          <br>
          <span style="color: #4caf50; font-weight: 600">테마 4개</span> + 
          <span style="color: #2196f3; font-weight: 600">활동 5개</span> + 
          <span style="color: #ff9800; font-weight: 600">장소 6개</span>까지 선택 가능! 
          <br>
          <small>🎯 더 많이 선택할수록 더 풍부한 결과를 얻을 수 있어요!</small>
        </p>
      </div>

      <!-- Search Filters -->
      <div class="search-filters">
        <div class="filter-row">
          <!-- 지역 선택기 -->
          <div class="filter-group">
            <label>여행지역 <small class="required">*</small></label>
            <div class="region-selector-container">
              <select class="filter-select" id="regionFilter">
                <option value="">여행지역</option>
              </select>
              <select
                class="filter-select"
                id="sigunguFilter"
                style="display: none"
              >
                <option value="">시군구 선택</option>
              </select>
            </div>
          </div>

          <!-- 선호테마 (4개로 확대) -->
          <div class="filter-group">
            <label>선호테마 <span class="selection-count">최대 4개</span></label>
            <div class="custom-dropdown-container" id="themeFilterContainer">
              <div class="dropdown-trigger" data-target="themeOptions">
                <span class="dropdown-label">선호테마</span>
                <span class="dropdown-arrow">▼</span>
              </div>
              <div class="dropdown-options" id="themeOptions">
                <!-- JavaScript에서 동적 생성 -->
              </div>
            </div>
          </div>

          <!-- 선호활동 (5개로 확대) -->
          <div class="filter-group">
            <label>선호활동 <span class="selection-count">최대 5개</span></label>
            <div class="custom-dropdown-container" id="activityFilterContainer">
              <div class="dropdown-trigger" data-target="activityOptions">
                <span class="dropdown-label">선호활동</span>
                <span class="dropdown-arrow">▼</span>
              </div>
              <div class="dropdown-options" id="activityOptions">
                <!-- JavaScript에서 동적 생성 -->
              </div>
            </div>
          </div>

          <!-- 장소 (6개로 확대) -->
          <div class="filter-group">
            <label>장소 <span class="selection-count">최대 6개</span> <small class="group-info">(7그룹)</small></label>
            <div class="custom-dropdown-container" id="placeFilterContainer">
              <div class="dropdown-trigger" data-target="placeOptions">
                <span class="dropdown-label">장소</span>
                <span class="dropdown-arrow">▼</span>
              </div>
              <div class="dropdown-options grouped-options" id="placeOptions">
                <!-- JavaScript에서 7그룹 동적 생성 -->
              </div>
            </div>
          </div>

          <!-- 편의시설 -->
          <div class="filter-group">
            <label>편의시설</label>
            <select class="filter-select" id="needsFilter">
              <option value="">편의시설</option>
            </select>
          </div>

          <!-- 방문지 수 -->
          <div class="filter-group">
            <label>방문지 수</label>
            <select class="filter-select" id="curationCount">
              <option value="">방문지 수</option>
              <option value="3">3개 (간단)</option>
              <option value="6" selected>6개 (적당)</option>
              <option value="9">9개 (풍성)</option>
              <option value="12">12개 (완전)</option>
              <option value="15">15개 (최대)</option>
            </select>
          </div>

          <!-- 검색 버튼 -->
          <div class="filter-group">
            <button id="doSearchBtn" class="btn-primary">
              🔍 검색하기
            </button>
            <button id="clearFiltersBtn" class="btn-secondary">
              🔄 초기화
            </button>
          </div>
        </div>

        <!-- Interest Tags -->
        <div class="interest-tags" id="interestTags">
          <div class="text-center">
            <div class="placeholder-icon">🎯</div>
            <h3>선택 수가 확대되었어요!</h3>
            <p>
              <strong>테마 4개 + 활동 5개 + 장소 6개</strong>까지 선택 가능
              <br>
              <small>논리적 조합만 검색되어 더 정확한 결과를 제공합니다</small>
            </p>
          </div>
        </div>
      </div>

      <!-- Recommended Tours Section -->
      <div class="tours-section">
        <div class="section-header">
          <h2 class="section-title">
            📌 회원님을 위한 맞춤 투어
          </h2>
          <div class="section-subtitle">
            논리적 조합 최적화 + 선택 수 확대로 더 정확하고 풍부한 결과 (v2.3)
          </div>
        </div>
        <div class="tour-list" id="recommendedTours">
          <div class="recommendation-placeholder">
            <div class="placeholder-icon">🔍</div>
            <h3>v2.3 Enhanced 검색을 시작해보세요!</h3>
            <p>확대된 선택 옵션으로 더 정확한 맞춤 투어를 찾아보세요.<br>
               필터를 설정한 후 <strong>🔍 검색하기</strong> 버튼을 눌러주세요!</p>
            <div class="search-hint">
              <div class="hint-item">
                <span class="hint-number">1</span>
                <span class="hint-text">지역 1개 선택 (17개 광역시도)</span>
              </div>
              <div class="hint-item">
                <span class="hint-number">2</span>
                <span class="hint-text">테마 최대 4개, 활동 최대 5개, 장소 최대 6개 선택</span>
              </div>
              <div class="hint-item">
                <span class="hint-number">3</span>
                <span class="hint-text">🔍 검색하기 버튼으로 논리적 조합만 검색</span>
              </div>
            </div>
          </div>
        </div>
      </div>
       <!-- 추천 코스 섹션 -->
      <div class="tours-section">
        <div class="section-header">
          <h2 class="section-title">🔍 이런 코스는 어떠세요?</h2>
          <div class="section-subtitle">선택하신 조건에 맞는 추천 여행코스</div>
          <div class="result-count" id="resultCount" style="display: none">
            총 <span class="count-number">0</span>개의 코스
          </div>
        </div>

        <!-- 지역+테마 조합 코스 -->
        <div class="course-section" id="coursesByTheme">
          <h3 class="course-section-title">
            <span class="course-icon">🎨</span>
            선택하신 지역 + 테마 조합 코스
          </h3>
          <div class="tour-list" id="themeBasedCourses">
            <div class="search-placeholder">
              <div class="placeholder-icon">🎨</div>
              <h4>지역과 테마를 선택하면 맞춤 코스가 표시됩니다</h4>
              <p>위의 필터에서 지역과 선호테마를 설정해주세요!</p>
            </div>
          </div>
        </div>

        <!-- 지역+활동 조합 코스 -->
        <div class="course-section" id="coursesByActivity">
          <h3 class="course-section-title">
            <span class="course-icon">🎯</span>
            선택하신 지역 + 활동 조합 코스
          </h3>
          <div class="tour-list" id="activityBasedCourses">
            <div class="search-placeholder">
              <div class="placeholder-icon">🎯</div>
              <h4>지역과 활동을 선택하면 맞춤 코스가 표시됩니다</h4>
              <p>위의 필터에서 지역과 선호활동을 설정해주세요!</p>
            </div>
          </div>
        </div>

        <!-- No Results Message -->
        <div class="no-results" id="noCourses" style="display: none">
          <div class="no-results-icon">😅</div>
          <h3>추천 코스가 없습니다</h3>
          <p>
            다른 지역이나 테마/활동을 선택해보시거나 7그룹 장소에서 다른 옵션을
            확인해주세요
          </p>
          <div class="main-category-suggestions">
            <button
              class="suggestion-btn"
              onclick="tourSearchManager.applyQuickFilter('nature')"
            >
              🌿 자연 코스
            </button>
            <button
              class="suggestion-btn"
              onclick="tourSearchManager.applyQuickFilter('culture')"
            >
              🏛️ 문화 코스
            </button>
            <button
              class="suggestion-btn"
              onclick="tourSearchManager.applyQuickFilter('activity')"
            >
              🏃‍♂️ 레포츠 코스
            </button>
          </div>
          <button
            class="retry-search-btn"
            onclick="tourSearchManager.clearFilters()"
          >
            필터 초기화하고 다시 검색
          </button>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination" id="pagination" style="display: none">
        <button class="pagination-btn prev" id="prevBtn">&lt;</button>
        <div class="pagination-numbers" id="paginationNumbers"></div>
        <button class="pagination-btn next" id="nextBtn">&gt;</button>
      </div>
    </div>
      <!-- 논리적 조합 안내 -->
      <div class="tours-section">
        <div class="section-header">
          <h2 class="section-title">💡 논리적 조합 예시</h2>
          <div class="section-subtitle">
            이런 조합들이 올바른 검색 결과를 제공합니다
          </div>
        </div>
        
        <div class="logical-combination-guide">
          <div class="combination-examples">
            <div class="example-item valid">
              <span class="example-icon">✅</span>
              <div class="example-text">
                <strong>자연 + 자연감상 + 해변</strong>
                <small>완벽한 논리적 조합</small>
              </div>
            </div>
            <div class="example-item valid">
              <span class="example-icon">✅</span>
              <div class="example-text">
                <strong>문화/역사 + 역사탐방 + 사찰</strong>
                <small>완벽한 논리적 조합</small>
              </div>
            </div>
            <div class="example-item valid">
              <span class="example-icon">✅</span>
              <div class="example-text">
                <strong>레포츠 + 육상레포츠 + 골프장</strong>
                <small>완벽한 논리적 조합</small>
              </div>
            </div>
            <div class="example-item invalid">
              <span class="example-icon">❌</span>
              <div class="example-text">
                <strong>문화/역사 + 역사탐방 + 해변</strong>
                <small>논리적으로 맞지 않는 조합 (검색 안됨)</small>
              </div>
            </div>
          </div>
          
          <div class="combination-tip">
            <h4>💡 검색 팁</h4>
            <ul>
              <li><strong>테마, 활동, 장소</strong>가 서로 연관되도록 선택하세요</li>
              <li><strong>자연</strong> 테마라면 <strong>자연감상</strong> 활동과 <strong>해변/산</strong> 장소를 선택</li>
              <li><strong>문화/역사</strong> 테마라면 <strong>역사탐방</strong> 활동과 <strong>사찰/고궁</strong> 장소를 선택</li>
              <li>논리적으로 맞지 않는 조합은 자동으로 제외되어 더 정확한 결과를 제공합니다</li>
            </ul>
          </div>
        </div>
      </div>

    <!-- Footer -->
    <div th:replace="~{footer :: footer}"></div>

    <!-- Modal -->
    <div class="modal-overlay" id="tourDetailModal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modalTitle">투어 상세 정보</h2>
          <button class="modal-close" onclick="tourSearchManager.closeModal()">
            &times;
          </button>
        </div>
        <div class="modal-body" id="modalBody"></div>
        <div class="modal-footer">
          <small>
            🚀 v2.3 Enhanced: 논리적 조합 + 선택 확대로 더 정확한 투어 정보
          </small>
        </div>
      </div>
    </div>

    <!-- JavaScript 파일들 -->
    <script src="/js/tour-utils.js"></script>
    <script src="/js/tour-search.js"></script>
    
    <!-- 간단한 초기화 스크립트 -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        console.log('🚀 Tour Search v2.3 Enhanced 로드 완료');
        console.log('✨ 핵심 기능: 논리적 조합 최적화 + 선택 수 확대');
      });
    </script>
  </body>
</html>